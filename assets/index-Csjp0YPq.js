import{g as L,o as W,a as E,n as j,u as N,b as U,r as C,w as D,c as M,s as A,d as x,e as T,V as B,f as F,h as g,i as _,t as I,j as O}from"./index-HJ472lga.js";import{u as R}from"./list-DfTS3LK4.js";import{u as q}from"./settings-D_f42h7v.js";import{V as P,a as H}from"./VRow-uUh_FIsZ.js";function k(e){return L()?(W(e),!0):!1}function b(){const e=new Set,t=o=>{e.delete(o)};return{on:o=>{e.add(o);const i=()=>t(o);return k(i),{off:i}},off:t,trigger:(...o)=>Promise.all(Array.from(e).map(i=>i(...o)))}}function V(e){return typeof e=="function"?e():N(e)}const $=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const z=Object.prototype.toString,J=e=>z.call(e)==="[object Object]",K=()=>{};function Q(e){return U()}function X(e,t=!0,n){Q()?E(e,n):t?e():j(e)}function Y(e){var t;const n=V(e);return(t=n==null?void 0:n.$el)!=null?t:n}const G=$?window:void 0;function Z(...e){let t,n,s,o;if(typeof e[0]=="string"||Array.isArray(e[0])?([n,s,o]=e,t=G):[t,n,s,o]=e,!t)return K;Array.isArray(n)||(n=[n]),Array.isArray(s)||(s=[s]);const i=[],r=()=>{i.forEach(a=>a()),i.length=0},p=(a,u,l,c)=>(a.addEventListener(u,l,c),()=>a.removeEventListener(u,l,c)),h=D(()=>[Y(t),V(o)],([a,u])=>{if(r(),!a)return;const l=J(u)?{...u}:u;i.push(...n.flatMap(c=>s.map(w=>p(a,c,w,l))))},{immediate:!0,flush:"post"}),m=()=>{h(),r()};return k(m),m}function ee(){const e=C(!1),t=U();return t&&E(()=>{e.value=!0},t),e}function te(e){const t=ee();return M(()=>(t.value,!!e()))}function ne(e={}){const{window:t=G,requestPermissions:n=!0}=e,s=e,o=te(()=>{if(!t||!("Notification"in t))return!1;try{new Notification("")}catch{return!1}return!0}),i=C(o.value&&"permission"in Notification&&Notification.permission==="granted"),r=C(null),p=async()=>{if(o.value)return!i.value&&Notification.permission!=="denied"&&await Notification.requestPermission()==="granted"&&(i.value=!0),i.value},{on:h,trigger:m}=b(),{on:a,trigger:u}=b(),{on:l,trigger:c}=b(),{on:w,trigger:y}=b(),d=async f=>{if(!o.value||!i.value)return;const S=Object.assign({},s,f);return r.value=new Notification(S.title||"",S),r.value.onclick=m,r.value.onshow=u,r.value.onerror=c,r.value.onclose=y,r.value},v=()=>{r.value&&r.value.close(),r.value=null};if(n&&X(p),k(v),o.value&&t){const f=t.document;Z(f,"visibilitychange",S=>{S.preventDefault(),f.visibilityState==="visible"&&v()})}return{isSupported:o,notification:r,ensurePermissions:p,permissionGranted:i,show:d,close:v,onClick:h,onShow:a,onError:l,onClose:w}}const ae={__name:"index",setup(e){const t={STOP:0,COUNTING:1,PAUSE:2},n=C(t.STOP),s=R(),{currentItem:o,items:i,timeleft:r}=A(s),{setCurrentItem:p,countdown:h,setFinishItem:m}=s,a=q(),{selectedAlarmFile:u}=A(a);let l=0;const c=()=>{n.value===t.STOP&&i.value.length>0&&p(),n.value=t.COUNTING,l=setInterval(()=>{h(),r.value===0&&y()},1e3)},w=()=>{n.value=t.PAUSE,clearInterval(l)},y=()=>{clearInterval(l),n.value=t.STOP;const d=new Audio;d.src=u.value,d.play();const{show:v,isSupported:f}=ne({title:"事項完成",body:o.value,icon:new URL(""+new URL("tomato-DWEDH35s.png",import.meta.url).href,import.meta.url).href});f.value&&v(),m(),i.value.length>0&&c()};return(d,v)=>(F(),x(B,null,{default:T(()=>[g(H,null,{default:T(()=>[g(P,{cols:"12"},{default:T(()=>[_("h1",null,"目前事項 "+I(d.currentText),1),_("h2",null,"剩餘時間 "+I(d.currentTime),1)]),_:1}),g(P,{cols:"12"},{default:T(()=>[g(O,{icon:"mdi-play",onClick:c,disabled:n.value===t.COUNTING||N(o).length===0&&N(i).length===0},null,8,["disabled"]),g(O,{icon:"mdi-pause",disabled:n.value!==t.COUNTING,onClick:w},null,8,["disabled"]),g(O,{icon:"mdi-skip-next",disabled:N(o).length===0,onClick:y},null,8,["disabled"])]),_:1})]),_:1})]),_:1}))}};export{ae as default};
