import{g as G,o as L,a as E,n as W,u as N,b as U,r as C,w as j,c as D,_ as M,s as k,d as B,e as T,V as F,f as R,h as g,i as A,t as I,j as _}from"./index-CxnSRrpJ.js";import{u as q}from"./list-d4o6J0Ov.js";import{u as H}from"./settings-BggFq83U.js";import{V as P,a as $}from"./VRow-DHHSEl-4.js";function O(e){return G()?(L(e),!0):!1}function b(){const e=new Set,t=o=>{e.delete(o)};return{on:o=>{e.add(o);const i=()=>t(o);return O(i),{off:i}},off:t,trigger:(...o)=>Promise.all(Array.from(e).map(i=>i(...o)))}}function V(e){return typeof e=="function"?e():N(e)}const z=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const J=Object.prototype.toString,K=e=>J.call(e)==="[object Object]",Q=()=>{};function X(e){return U()}function Y(e,t=!0,n){X()?E(e,n):t?e():W(e)}function Z(e){var t;const n=V(e);return(t=n==null?void 0:n.$el)!=null?t:n}const x=z?window:void 0;function ee(...e){let t,n,s,o;if(typeof e[0]=="string"||Array.isArray(e[0])?([n,s,o]=e,t=x):[t,n,s,o]=e,!t)return Q;Array.isArray(n)||(n=[n]),Array.isArray(s)||(s=[s]);const i=[],r=()=>{i.forEach(a=>a()),i.length=0},p=(a,u,l,c)=>(a.addEventListener(u,l,c),()=>a.removeEventListener(u,l,c)),h=j(()=>[Z(t),V(o)],([a,u])=>{if(r(),!a)return;const l=K(u)?{...u}:u;i.push(...n.flatMap(c=>s.map(w=>p(a,c,w,l))))},{immediate:!0,flush:"post"}),m=()=>{h(),r()};return O(m),m}function te(){const e=C(!1),t=U();return t&&E(()=>{e.value=!0},t),e}function ne(e){const t=te();return D(()=>(t.value,!!e()))}function oe(e={}){const{window:t=x,requestPermissions:n=!0}=e,s=e,o=ne(()=>{if(!t||!("Notification"in t))return!1;try{new Notification("")}catch{return!1}return!0}),i=C(o.value&&"permission"in Notification&&Notification.permission==="granted"),r=C(null),p=async()=>{if(o.value)return!i.value&&Notification.permission!=="denied"&&await Notification.requestPermission()==="granted"&&(i.value=!0),i.value},{on:h,trigger:m}=b(),{on:a,trigger:u}=b(),{on:l,trigger:c}=b(),{on:w,trigger:y}=b(),d=async f=>{if(!o.value||!i.value)return;const S=Object.assign({},s,f);return r.value=new Notification(S.title||"",S),r.value.onclick=m,r.value.onshow=u,r.value.onerror=c,r.value.onclose=y,r.value},v=()=>{r.value&&r.value.close(),r.value=null};if(n&&Y(p),O(v),o.value&&t){const f=t.document;ee(f,"visibilitychange",S=>{S.preventDefault(),f.visibilityState==="visible"&&v()})}return{isSupported:o,notification:r,ensurePermissions:p,permissionGranted:i,show:d,close:v,onClick:h,onShow:a,onError:l,onClose:w}}const ie={__name:"index",setup(e){const t={STOP:0,COUNTING:1,PAUSE:2},n=C(t.STOP),s=q(),{currentItem:o,items:i,timeleft:r}=k(s),{setCurrentItem:p,countdown:h,setFinishItem:m}=s,a=H(),{selectedAlarmFile:u}=k(a);let l=0;const c=()=>{n.value===t.STOP&&i.value.length>0&&p(),n.value=t.COUNTING,l=setInterval(()=>{h(),r.value===0&&y()},1e3)},w=()=>{n.value=t.PAUSE,clearInterval(l)},y=()=>{clearInterval(l),n.value=t.STOP;const d=new Audio;d.src=u.value,d.play();const{show:v,isSupported:f}=oe({title:"事項完成",body:o.value,icon:new URL(""+new URL("tomato-DWEDH35s.png",import.meta.url).href,import.meta.url).href});f.value&&v(),m(),i.value.length>0&&c()};return(d,v)=>(R(),B(F,null,{default:T(()=>[g($,null,{default:T(()=>[g(P,{cols:"12"},{default:T(()=>[A("h1",null,"目前事項 "+I(d.currentText),1),A("h2",null,"剩餘時間 "+I(d.currentTime),1)]),_:1}),g(P,{cols:"12"},{default:T(()=>[g(_,{icon:"mdi-play",onClick:c,disabled:n.value===t.COUNTING||N(o).length===0&&N(i).length===0},null,8,["disabled"]),g(_,{icon:"mdi-pause",disabled:n.value!==t.COUNTING,onClick:w},null,8,["disabled"]),g(_,{icon:"mdi-skip-next",disabled:N(o).length===0,onClick:y},null,8,["disabled"])]),_:1})]),_:1})]),_:1}))}},le=M(ie,[["__scopeId","data-v-ad84ee26"]]);export{le as default};
